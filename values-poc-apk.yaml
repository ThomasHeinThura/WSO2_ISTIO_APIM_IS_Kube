# POC values for WSO2 APK ("APK" 1.3.x style values)
# This file is aligned to the reference layout in
# `WSO2_ISTIO_APIM_IS_Kube/1.3.0-1-cp-enabled-values.yaml`.

wso2:
  subscription:
    imagePullSecrets: ""

  apk:
    helmHooks:
      webhooksCleanupEnabled: true
      webhooksCleanup:
        enabled: true
        image: "bitnamilegacy/kubectl:1.31.1"
    webhooks:
      validatingwebhookconfigurations: true
      mutatingwebhookconfigurations: true
      conversionwebhookconfigurations: true
    auth:
      enabled: true
      enableServiceAccountCreation: true
      enableClusterRoleCreation: true
      serviceAccountName: wso2apk-platform
      roleName: wso2apk-role
    listener:
      hostname: "api.am.wso2.com"
      port: 9095

    idp:
      issuer: "https://idp.am.wso2.com/token"
      usernameClaim: "sub"
      organizationClaim: "organization"
      groupsClaim: "groups"
      consumerKeyClaim: "clientId"

    cp:
      enabledSubscription: true
      host: "apim-apk-agent-service.apk.svc.cluster.local"
      skipSSLVerification: true

    dp:
      enabled: true
      gateway:
        listener:
          hostname: "gw.wso2.com"
        service: {}

      configdeployer:
        enabled: true
        deployment:
          replicas: 1
          imagePullPolicy: Always
          image: wso2/apk-config-deployer-service:1.3.0

      adapter:
        deployment:
          replicas: 1
          imagePullPolicy: Always
          image: wso2/apk-adapter:1.3.0
          security:
            sslHostname: "adapter"
          logging:
            level: "INFO"
          configs:
            enableGatewayClassController: false

      commonController:
        deployment:
          replicas: 1
          imagePullPolicy: Always
          image: wso2/apk-common-controller:1.3.0
          security:
            sslHostname: "commoncontroller"

      ratelimiter:
        enabled: true
        deployment:
          replicas: 1
          imagePullPolicy: Always
          image: wso2/apk-ratelimiter:1.3.0
          security:
            sslHostname: "ratelimiter"

      gatewayRuntime:
        deployment:
          replicas: 1
          router:
            imagePullPolicy: Always
            image: wso2/apk-router:1.3.0
          enforcer:
            imagePullPolicy: Always
            image: wso2/apk-enforcer:1.3.0
            security:
              sslHostname: "enforcer"
            env:
              TOKEN_REVOCATION_ENABLED: "true"
            configs:
              apiKey:
                enabled: true
                issuer: "https://am.wso2.com:443/oauth2/token"

    metrics:
      enabled: false

# IMPORTANT: In the reference values, `idp:` is a top-level key (not under `wso2.apk`).
idp:
  enabled: true
  listener:
    hostname: "idp.am.wso2.com"
  database:
    # POC: use the shared MySQL in `wso2` namespace.
    driver: "com.mysql.cj.jdbc.Driver"
    url: "jdbc:mysql://mysql.wso2.svc.cluster.local:3306/WSO2AM_DB?autoReconnect=true&useSSL=false&allowPublicKeyRetrieval=true"
    host: "mysql.wso2.svc.cluster.local"
    port: 3306
    databaseName: "WSO2AM_DB"
    username: "wso2carbon"
    secretName: "apk-db-secret"
    secretKey: "DB_PASSWORD"
    validationQuery: "SELECT 1"
    validationTimeout: 250
  idpds:
    configs:
      issuer: "https://idp.am.wso2.com/token"
      keyId: "gateway_certificate_alias"
      hostname: "idp.am.wso2.com"
      loginPageURl: "https://idp.am.wso2.com:9095/authenticationEndpoint/login"
      loginErrorPageUrl: "https://idp.am.wso2.com:9095/authenticationEndpoint/error"
      loginCallBackURl: "https://idp.am.wso2.com:9095/authenticationEndpoint/login-callback"
    deployment:
      replicas: 1
      imagePullPolicy: Always
      image: wso2/apk-idp-domain-service:1.3.0
  idpui:
    deployment:
      replicas: 1
      imagePullPolicy: Always
      image: wso2/apk-idp-ui:1.3.0
    configs:
      idpLoginUrl: "https://idp.am.wso2.com:9095/commonauth/login"
      idpAuthCallBackUrl: "https://idp.am.wso2.com:9095/oauth2/auth-callback"

gatewaySystem:
  enabled: true
  enableServiceAccountCreation: true
  enableClusterRoleCreation: true
  serviceAccountName: gateway-api-admission
  applyGatewayWehbhookJobs: true
  deployment:
    image: registry.k8s.io/gateway-api/admission-server:v1.0.0
    imagePullPolicy: Always

certmanager:
  enabled: true
  enableClusterIssuer: true
  enableRootCa: true
  rootCaSecretName: "apk-root-certificate"

postgresql:
  enabled: false

redis:
  enabled: true
  architecture: standalone
  auth:
    enabled: false
    usePasswordFiles: false

global:
  security:
    allowInsecureImages: true
