# POC values for WSO2 APK (Control Plane Enabled)
# Based on 1.3.0-1-cp-enabled-values.yaml

wso2:
  apk:
    listener:
      hostname: "api.am.wso2.com"
      port: 9095
    
    idp:
      issuer: "https://idp.am.wso2.com/token"
      usernameClaim: "sub"
      organizationClaim: "organization"
      groupsClaim: "groups"
      consumerKeyClaim: "clientId"
    
    cp:
      enabledSubscription: true
      host: "apim-apk-agent-service.apk.svc.cluster.local"
      skipSSLVerification: true
    
    dp:
      enabled: true
      gateway:
        listener:
          hostname: "gw.wso2.com"
      
      configdeployer:
        enabled: true
        deployment:
          image: "wso2/apk-config-deployer-service:1.3.0"
          replicas: 1
      
      adapter:
        deployment:
          image: "wso2/apk-adapter:1.3.0"
          replicas: 1
        configs:
          enableGatewayClassController: false
      
      commonController:
        deployment:
          image: "wso2/apk-common-controller:1.3.0"
          replicas: 1
      
      ratelimiter:
        enabled: true
        deployment:
          image: "wso2/apk-ratelimiter:1.3.0"
          replicas: 1
      
      gatewayRuntime:
        deployment:
          replicas: 1
        router:
          image: "wso2/apk-router:1.3.0"
        enforcer:
          image: "wso2/apk-enforcer:1.3.0"
          configs:
            apiKey:
              enabled: true
              issuer: "https://am.wso2.com:443/oauth2/token"

    idp:
      enabled: true
      listener:
        hostname: "idp.am.wso2.com"
      database:
        # Using shared MySQL for APK IDP (WSO2AM_DB)
        driver: "com.mysql.cj.jdbc.Driver"
        url: "jdbc:mysql://mysql.wso2.svc.cluster.local:3306/WSO2AM_DB?autoReconnect=true&useSSL=false&allowPublicKeyRetrieval=true"
        host: "mysql.wso2.svc.cluster.local"
        port: 3306
        databaseName: "WSO2AM_DB"
        username: "wso2carbon"
        secretName: "apk-db-secret" # We will create this secret manually or via script
        secretKey: "DB_PASSWORD"
        validationQuery: "SELECT 1"
      
      idpds:
        configs:
          issuer: "https://idp.am.wso2.com/token"
          hostname: "idp.am.wso2.com"
          loginPageURl: "https://idp.am.wso2.com:9095/authenticationEndpoint/login"
          loginErrorPageUrl: "https://idp.am.wso2.com:9095/authenticationEndpoint/error"
          loginCallBackURl: "https://idp.am.wso2.com:9095/authenticationEndpoint/login-callback"
        deployment:
          image: "wso2/apk-idp-domain-service:1.3.0"
          replicas: 1
      
      idpui:
        deployment:
          image: "wso2/apk-idp-ui:1.3.0"
          replicas: 1
        configs:
          idpLoginUrl: "https://idp.am.wso2.com:9095/commonauth/login"
          idpAuthCallBackUrl: "https://idp.am.wso2.com:9095/oauth2/auth-callback"

    gatewaySystem:
      enabled: true
      enableServiceAccountCreation: true
      enableClusterRoleCreation: true

    certmanager:
      enabled: true
      enableClusterIssuer: true
      enableRootCa: true

    # Disable internal Postgres and Redis if we want to use shared ones
    # For now, keeping Redis enabled as it's usually local to APK
    postgresql:
      enabled: false # We use external MySQL
    
    redis:
      enabled: true
      architecture: standalone
